\chapter{Аналитический раздел}
\label{cha:analysis}
%
% % В начале раздела  можно напомнить его цель
%
В компьютерной графике дизеринг используется для создания иллюзии глубины цвета для изображений с относительно небольшим количеством цветов в палитре. Отсутствующие цвета составляются из имеющихся путём их «перемешивания». Например, если необходимо получить отсутствующий в палитре фиолетовый цвет, его можно получить, разместив красные и синие пиксели в шахматном порядке; оранжевый цвет может быть составлен из красных и желтых точек.

При оптимизации изображений путём уменьшения количества цветов, применение дизеринга приводит к визуальному улучшению изображения, однако для отдельных сжатых форматов (например, PNG), увеличивает его размер.


Алгоритмы дизеринга подразделяются на следующие категории:

\begin{itemize}
	\item Случайный  дизеринг(Random dither);
	\item Шаблонный дизеринг(Patterning);
	\item Упорядоченный дизеринг(Ordered);
	\item Дизеринг рассеивания ошибок( Error-diffusion);
	\item Прочие виды дизеринга
	
\end{itemize}

Нижеприведенные алгоритмы описываются для черно-белых изображений. Для цветных изображений алгоритмы аналогичны.

% Обратите внимание, что включается не ../dia/..., а inc/dia/...
% В Makefile есть соответствующее правило для inc/dia/*.pdf, которое
% берет исходные файлы из ../dia в этом случае.



\section{Случайный дизеринг}
Этот алгоритм тривиален.  По сравнению с остальными алгоритмами, его качество слишком низко, поэтому он применяется лишь там, где необходима  выcокая скорость работы в ущерб качеству.\cite{Dh} 
Для каждого пикселя в нашем черно-белом изображении мы генерируем случайное число в диапазоне 0-255: если случайное число больше, чем значение в данной точке, то отображаем белый пиксель, иначе отображаем черн пиксель.
Это создает изображение с большим количеством шумов. Хотя изображение выглядит неточным и зернистым, оно не содержит артефактов\cite{Dh}]. Этот метод дизеринга полезен при воспроизведении низкокачественных изображений, где отсутствие артефактов более важно, чем наличие шумов. Например, изображение содержит градиент всех уровней от черного до белого. Это изображение не будет иметь артефактов после того, как к нему применят случайный дизеринг, а остальные методы дизеринга приведут к возникновению артефактов \cite{Dh}. 

\section{Шаблонный дизеринг}

Шаблонный дизеринг подрузамевает то, что мы увеличиваем разрешение изображения. Так же, как и случайный дизеринг, это тривиальный алгоритм, но он гораздо более эффективен.\cite{Ulich}
Для каждой точки изображения мы генерируем «шаблон» пикселей, который аппроксимирует эту точку. Тем  самым  имтируется больший набор оттенков, чем поддерживает наша глубина цвета.
Например, шаблон 3х3. Он имеет 512 вариантов возможных расположений пикселей, но расположение пикселей не влияет на интенсивность цвета шаблона. Интенсивность формируется на основе количества черных пикселей, содержащихся в шаблоне. То есть возможных вариантов 10. \\
%\begin{verbatim}
$\begin{vmatrix}
\square&\square&\square \\
\square &\square&\square \\
\square &\square&\square 
\end{vmatrix}$
$\begin{vmatrix}
\square&\square&\square \\
\square &\blacksquare&\square \\
\square &\square&\square 
\end{vmatrix}$ 
$\begin{vmatrix}
\square&\square&\square \\
\square &\blacksquare&\blacksquare \\
\square &\square&\square 
\end{vmatrix}$ 
$\begin{vmatrix}
\square&\blacksquare&\square \\
\square &\blacksquare&\blacksquare \\
\square &\square&\square 
\end{vmatrix}$ 
$\begin{vmatrix}
\square&\blacksquare&\blacksquare \\
\square &\blacksquare&\blacksquare \\
\square &\square&\square 
\end{vmatrix}$ \\
$\begin{vmatrix}
\square&\blacksquare&\blacksquare \\
\square &\blacksquare&\blacksquare \\
\square &\blacksquare&\square 
\end{vmatrix}$ 
$\begin{vmatrix}
\square&\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\blacksquare \\
\square &\blacksquare&\square 
\end{vmatrix}$ 
$\begin{vmatrix}
\square&\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\square 
\end{vmatrix}$ 	 
$\begin{vmatrix}
\square&\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\blacksquare 
\end{vmatrix}$ 
$\begin{vmatrix}
\blacksquare&\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\blacksquare \\
\blacksquare &\blacksquare&\blacksquare 
\end{vmatrix}$ 
%\end{verbatim}


\section{Упорядоченный дизеринг}
%возможно, это вранье, ПЕРЕЧИТАТЬ ОРИГИНАЛ ЕЩЁ РАЗ
Значительным недостатком шаблонного дизеринга явлется пространственное увеличение картинки(и увеличение её разрешения). Упорядоченный дизеринг позволяет избежать этого пространственного искажения. Для того, чтобы достичь этого, каждый пиксель в исходном изображении   сопоставляется c пикселем на конечном изображении  один-к-одному.Существуют два вида упорядоченного дизеринга: кластерный и дисперсный.
Суть этих методов заключается в том, что  исходное изображение разбивается на квадраты пикселей и значения маски в каждой точке квадрата выступает в роли порогового значения. Если значение цвета пикселя(отмастшабированное под интервал маски) в данной точке больше значения маски, то красим пиксель в черный цвет, иначе в белый. Кластерные паттерны выглядят следующим образом:\\
$\begin{vmatrix}
8&  3 & 4  \\                      
6&  1&  2   \\                 
7 & 5 & 9  \\
\end{vmatrix}    $   ~    ~  ~  ~        
$\begin{vmatrix}
1 &  7 & 4 \\
5 & 8 & 3 \\
6 & 2 & 9 \\
\end{vmatrix}$

Кластерные паттерны применяются в случаях когда понятие «конкретный пиксель» у устройства вывода информации отсутсвует(ЭЛТ-мониторы и подобное). Во многих исследованиях \cite{Bayer}\cite{Dh} было отмечено, что если устройство вывода позволяет применить дисперсный метод, то его применение является предпочтительным.Так же Байер \cite{Bayer} показал, что для матриц порядков степени двух существует оптимальная структура дисперсных точек, которая приводит к наименьшему количеству шумов(для матрицы 2х2 и 4х4 соотвественно):\\
$\begin{vmatrix}
1 & 3 \\          
4 & 2   \\
\end{vmatrix}$ ~~~
$\begin{vmatrix}
1& 9& 3& 11\\
13& 5& 15& 7\\
4& 12& 2& 10\\
16& 8&14&6\\
\end{vmatrix}$\\
Основным недостатком данного метода считается то, что в результате его работы формируется большое количество артефактов\cite{Ulich}.
\section{Дизеринг при помощи диффузии ошибок}
Метод, обладающий наилучшим качеством среди представленных, - метод рассеивания ошибок. Но так же он, к сожалению, самый медленный.\cite{Dh} Существуют несколько вариантов этого алгоритма, причем скорость алгоритма обратно пропорционально качеству изображения.\cite{Dh}
Суть алгоритма: для каждой точки изображения находим ближайший возможный цвет. Затем мы рассчитываем разницу между текущим значеним и ближайшим возможным. Эта разница и будем нашем значением ошибки.Это значение ошибки мы распределяем между соседними элементами, которые мы ещё не посещали. Для последних точек ошибка распределяется между уже посещенными точками.
\section{Вариации алгоритма дизернга при помощи диффузии ошибок}
Линия сканирование движется слева-направо. Когда линия сканирования доходит до конца горизонтальной строки пикселей, переходим к первому пикселю следующей строки и повторяем необходимые действия.\\
\textit{Примечание: числа на схемах - это доли от значения  ошибки. Например, 7/16 на схеме выглядит как 7. То есть 7 обозначает некую величину, равную значение ошибки*7/16 }
\subsection{Фильтр Флойда-Cтейнберга }
Каждый пиксель распределяет свою ошибку на соседние с ним пиксели. Коэффициенты были подобраны таким образом, что в районах с  интенсивностью 1/2 от общего количество оттенков, изображение выглядело похожим на шахматную доску.\\
$  \begin{vmatrix}
\boxminus & \boxtimes & 7\\
3 & 5 & 1
\end{vmatrix}$ (1/16)
\subsection{"Ложный"  фильтр Флойда-Стейнберга }
В случае сканирования слева-направо этот фильтр порождает большое количество артефактов.Чтобы получить изображение с меньшим количеством артефактов, нужно чётные строки сканировать справа-налево, а нечетные строки сканировать слева-направо.\\
$\begin{vmatrix}
\boxtimes & 3 \\
3 & 2 
\end{vmatrix} $(1/8)

\subsection{Фильтр Джарвиса,Джунка и Нинка}
В случае когда фильтры Флойда-Стейдберга дают недостаточно хороший результат, применяются фильтры с более широким распределением ошибки. Фильтр Джарвиса, Джунка и Нинка требует связи с 12 соседями, что очевидно ведет в большим затратам памяти и времени\cite{Dh}:\\
$\begin{vmatrix}
\boxminus & \boxminus & \boxtimes & 7 & 5\\
3 & 5 & 7 & 5 &3 \\
1 & 3 & 5 & 3 & 1 
\end{vmatrix}$(1/48)

\subsection{Фильтр Стаки}
Фильтр разработан на основе фильтра Джарвиса, Джунка и Нинка.После такого как мы вычислим 8/42 ошибки, остальные значения можно получить при помощи побитовых сдвигов, тем самым сокращая время работы алгоритма.\\
$\begin{vmatrix}
\boxminus & \boxminus & \boxtimes & 8 & 4 \\
2 & 4 & 8 & 4 & 2 \\
1 & 2 & 4 & 2 & 1

\end{vmatrix}$ (1/42)

\subsection{Фильтр Бурка}
Стаки. Результат можно получить чуть быстрее за счет использования побитовых операций.\\
$\begin{vmatrix}
\boxminus &  \boxminus & \boxtimes  & 8 & 4\\
2 & 4 & 8 & 4 & 2
\end{vmatrix}$ (1/32)\\
Существует много различных вариантов фильтро дизеринга при помощи диффузии ошибок, здесь приведены наиболее  популярные алгоритмы.\cite{Dh}
\section{Прочие виды дизеринга}
Компьютерная графика не стоит на месте и завидной переодичностью появляются всё новые виды дизеринга, не укладывающиеся в привычную классификацию.
\subsection{Алгоритм Юлиомы}
Существует три вариации этого алгоритма \cite{Wiki_Yliluoma} значительно отличающиеся друг от друга. Основная идея этих алгоритмов заключается в оптимальном подборе цвета ограниченной цветовой палитры, основываваясь на визуальном восприятии этого цвета, а не на его числовом коде. Отличается от остальных алгоритмов значительными временными затратами, что делает применение этого алгоритма для решения практических задач затруднительным.

\section{Выбор оптимального класса алгоритма}
Вышеприведенные методы упорядочены по качеству получаемого на выходе изображения, однако, такие соображения как время, экономия памяти и прочие являются определяющими при выборе алгоритма\cite{Dh}.
На основе вышеприведенных данных сравним классы алгоритмов дизеринга.
\begin{tabular}{|@{\hspace*{2mm}}l||*{3}{c|}}\hline
	\multicolumn{1}{|@{}l||}{\backslashbox[0pt][l]{Вид алгоритма}{Характеристика }}
	&\makebox[4em]{Cкорость}&\makebox[4em]{Качество}&\makebox[5em]{Доп память}
	%	&\makebox[3em]{6/3}&\makebox[3em]{6/4}
	\\\hline\hline
	Cлучайный&+&-&-\\\hline
	Шаблонный &+-&-+&+\\\hline
	Упорядоченный&-+&+-&-\\\hline
	Диффузия ошибок&-&+&+\\\hline
	Остальные &-&+&+\\\hline
\end{tabular}
\bigskip
\\
Самым быстрым классом алгоритмов дизеринга является случайный дизеринг.Однако, качество получаемых при помощи изображений низко. Алгоритмы упорядоченного дизеринга позволяют получить изображения более высокого качества, однако работают более медленно и требуют дополнительных затрат. В зависимости от вычислительных ресурсов и требуемого результата рациональным будет применение различых алгоритмов.
\section{Оценка алгоритмов}
n - количество пикселей в изображении

\begin{tabular}{|@{\hspace*{2mm}}l||*{3}{c|}}\hline
	\multicolumn{1}{|@{}l||}{\backslashbox[0pt][l]{Вид алгоритма}{Характеристика }}
	&\makebox[4em]{Время}&\makebox[4em]{Память}
	%	&\makebox[3em]{6/3}&\makebox[3em]{6/4}
	\\\hline\hline
	Cлучайный&O(n)&O(1)\\\hline
	Упорядоченный&O(n)&O(1)\\\hline
	Диффузия ошибок&O(n)&O(n)\\\hline
	Первый алгоритм Юлиомы &O($n^3$)&O(n)\\\hline
\end{tabular}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "rpz"
%%% End:
